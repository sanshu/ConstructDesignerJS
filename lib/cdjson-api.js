var CDJsonAPI;CDJsonAPI=(()=>{"use strict";var e={175:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});const l=jQuery;var s=r.n(l);const n=function(e,t){return console.log(`Loading ${e}: ${t}`),s().ajax({type:"GET",cache:!1,url:t,async:!1})},a=async function(e,t){let r=e.split("------------------------------------------------------------------------------------------------------------------------");o(r[5],t),i(r[4],t),c(r[3],t),u(r[1],t),p(r[2],t),f(r[0],t)},o=function(e,t){e=e.replace("DISOPRED2 output:","");const r=h(e);let l={color:"orange",label:"Disorder",values:[]};for(let e=5;e<r.length;e++){let t=r[e].split(" ");t.length>4&&l.values.push(parseFloat(t[t.length-1]))}t.qtracks.push(l)},i=function(e,t){e=e.replace("PSIPRED output:","");const r=h(e);let l={color:"#000",label:"Coil",values:[]},s={color:"red",label:"Helix",values:[]},n={color:"blue",label:"Strand",values:[]};for(let e=2;e<r.length;e++){let t=r[e].trim();if(0===t.length)continue;let a=t.replace(/  +/g," ").split(" ");if(a.length<6)continue;let o=a.length>6?1:0;l.values.push(parseFloat(a[3+o])),s.values.push(parseFloat(a[4+o])),n.values.push(parseFloat(a[5+o]))}t.qtracks.push(l),t.qtracks.push(s),t.qtracks.push(n)},c=function(e,t){e=e.replace("TMHMM output:",""),h(e).forEach((e=>{if((e=e.trim()).length>0&&!e.startsWith("#")){let r=e.replace(/\t+/g," ").replace(/ +/g," ").split(" ");r.length>4&&"TMhelix"===r[2].trim()&&t.overlayfeatures.features.push({start:parseInt(r[3].trim()),end:parseInt(r[4].trim()),color:"#9acd32",regionType:"TRANSMEMBRANE HELIX",flLabel:"TMhelix"})}}))},u=function(e,t){e=e.replace("SEG output:","");const r=h(e);r[0].startsWith(">")&&(r[0]="");let l,s=r.join("").trim(),n=/x+/g;for(;null!=(l=n.exec(s));)t.overlayfeatures.features.push({start:l.index,end:l.index+l[0].length,color:"#DDD",regionType:"LOW COMPLEXITY",label:"Low complexity"})},p=function(e,t){e=e.replace("COILS output:","");let r=h(e);r[0].startsWith(">")&&(r[0]="");let l,s=r.join(""),n=/x+/g;for(;null!=(l=n.exec(s));)t.overlayfeatures.features.push({start:l.index,end:l.index+l[0].length,color:"#444",regionType:"COILS",label:"Coils"})},f=function(e,t){e=e.replace("Protein sequence in FASTA format:",""),h(e).forEach((e=>{const r=e.split(":");r.length>1&&(t.properties[r[0].trim()]=r[1].trim())}))},g=async function(e,t,r){const l=r[0]||!1,s=r[1]||1;let a=/-+/g;const o=h(e);let i=-1,c=0,u=[],p="",f="",g="";for(let e=2;e<o.length&&!(c>s);e++){let r=o[e].trim();if(r.startsWith(">"))c++,f=r.substring(1).split(">")[1]||"",g=f.split(":")[0].trim();else if(i<0){let e,t=r.trim().split(" ");for(t.length>1&&(i=parseInt(t[0].trim()),p=t[1]);null!=(e=a.exec(p.trim()));)u.push({start:e.index,end:e.index+e[0].length})}else if(i>0){const e=g.split(" ")[0].replace("_","");let s=r.trim().split(" "),a={label:e,description:g,gaps:u,start:i,sequence:s[1].trim(),fragmentStart:parseInt(s[0].trim())};l||(a.CS="ALI");const o=(await n(`dssp for ${e} (${c})`,"https://ffas.godziklab.org/ffas/dssp/"+e)).split("\n");o[0]="";let p=o.join("");a.seqcolors={data:d(p,a.start,a.fragmentStart,a.gaps,a.sequence,t.sequence)},t.alignments.push(a),i=-1,u=[]}}},d=function(e,t,r,l,s,n){if(!e||!e.length)return"";s.substring(t-1);let a,o=/-+/g,i=e.substring(r-1),c=[];for(;null!=(a=o.exec(s.trim()));)c.push({start:a.index,end:a.index+a[0].length});let u=i.split("");for(let e=c.length;e>0;e--){let t=c[e-1];for(let e=t.start;e<t.end;e++)u.splice(e,0,".")}for(let e=l.length;e>0;e--){let t=l[e-1];for(let e=t.start;e<t.end;e++)u.splice(e,1,"")}return u.join("")},h=function(e){let t=e.trim().split("\n");return"SP:"===t[t.length-1].trim()&&t.pop(),t},m=function(e,t){const r=h(e);let l={color:"#8F6B00",label:"Surface accesibility",type:"column",values:[]};r.forEach((e=>{if(!(e=e.trim().replace(/\s+/g," ")).startsWith("#")){let t=e.split(" ");l.values.push(parseFloat(t[4])||0)}})),t.qtracks.push(l),console.log(l)},b=function(e,t){const r=h(e);let l={color:"#006600",label:"Evolutionary conservation",type:"column",values:[]};for(let e in r){let t=r[e].trim().replace(/\s+/g," ");if(t.startsWith("*"))break;let s=t.split(" ");l.values.push(parseFloat(s[2])||0)}t.qtracks.push(l)},y={getProtein:async(e,t,r)=>{const l=function(e){return new Promise((function(t,r){r("ConstructDesignerAPI failed: "+e)}))};!e&&l("No dir provided");const o="#696969",i="red",c="blue";let u={label:"",seq:"",seqcolors:{colors:{H:i,E:c,C:o,G:i,I:i,B:c,T:o,S:o," ":"#DDD",X:"orange"},data:""},alignments:[],qtracks:[],ftracks:[],overlayfeatures:{label:"Predictions",features:[]},markers:[],properties:{}};const p="https://xtalpred.godziklab.org/XtalPred-cgi/download.pl?dir="+e+"/",f=await function(e){return console.log("Loading fasta: "+e),s().ajax({type:"GET",cache:!1,url:e,async:!1})}(p+"A.csq");if(!f||!f.length)return null;let d=h(f);d[0].startsWith(">")&&(u.label=d[0].substring(1),d[0]=""),u.sequence=d.join(""),u.label=u.label.replace(/\r/g,""),u.sequence=u.sequence.replace(/\r/g,""),u.sequence=u.sequence.replace(/\n/g,"");const y=async function(e,t,r,s){try{const l=await n(e,t);await r(l,u,s)}catch(t){l(`Failed to load ${e}: ${t}`)}};return await y("Summary",p+"&type=summary",a),await y("psi-blast",p+"pdb101.ali",g,[t,r]),await y("SurfPred",p+"A.nets",m),await y("SurfPred",p+"A.co",b),u},parseDSSP:d}}},t={};function r(l){if(t[l])return t[l].exports;var s=t[l]={exports:{}};return e[l](s,s.exports,r),s.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var l in t)r.o(t,l)&&!r.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(175)})();